:original_name: cts_api_0311_01.html

.. _cts_api_0311_01:

Querying a Trace List (v3.0)
============================

Function
--------

This API is used to query records of operations on resources in the last seven days.

URI
---

GET /v3/{project_id}/traces

.. table:: **Table 1** URI parameter

   +------------+-----------+--------+--------------------------------------------------------------------------------------------------+
   | Parameter  | Mandatory | Type   | Description                                                                                      |
   +============+===========+========+==================================================================================================+
   | project_id | Yes       | String | Project ID. For details, see section :ref:`Obtain the Account ID and Project ID <cts_api_0126>`. |
   +------------+-----------+--------+--------------------------------------------------------------------------------------------------+

.. table:: **Table 2** Query parameters

   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type            | Description                                                                                                                                                                                                                                                                                                                                                                                               |
   +=================+=================+=================+===========================================================================================================================================================================================================================================================================================================================================================================================================+
   | trace_type      | Yes             | String          | Trace type. The value can be system (management trace). The default value is **system**.                                                                                                                                                                                                                                                                                                                  |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | limit           | No              | Integer         | Number of traces to query. The default value is **10** and the maximum value is **200**.                                                                                                                                                                                                                                                                                                                  |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | from            | No              | Long            | UTC millisecond timestamp of the query start time. The value contains 13 digits and the default value is the timestamp of the last hour. Traces generated after the specified timestamp will be queried. The parameters **from** and **to** should be used together.                                                                                                                                      |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | next            | No              | String          | This parameter is used to query traces generated earlier than its specified value. The value can be that of **marker** in the response. **next** can be used with **from** and **to**. Traces generated in the overlap of the two time ranges specified respectively by **next** and by **from** and **to** will be returned.                                                                             |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | to              | No              | Long            | UTC millisecond timestamp of the query end time. The value contains 13 digits and the default value is the timestamp of the current time. Traces generated before the specified timestamp will be queried. The parameters **to** and **from** should be used together.                                                                                                                                    |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | tracker_name    | No              | String          | When **trace_type** is set to **system**, the default value **system** is used. When **trace_type** is set to **data**, set this parameter to the name of a data tracker to query the traces recorded by this tracker.                                                                                                                                                                                    |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | service_type    | No              | String          | Type of a cloud service whose traces are to be queried. The value must be the acronym of a cloud service that has been connected with CTS. It is a word composed of uppercase letters. This parameter is valid only when **trace_type** is set to **system**. For cloud services that can be connected with CTS, see section "Supported Services and Operations" in the *Cloud Trace Service User Guide*. |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | user            | No              | String          | Name of the user whose traces are to be queried This parameter is valid only when **trace_type** is set to **system**.                                                                                                                                                                                                                                                                                    |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | resource_id     | No              | String          | ID of a cloud resource whose traces are to be queried. This parameter is valid only when **trace_type** is set to **system**.                                                                                                                                                                                                                                                                             |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | resource_name   | No              | String          | Name of a resource whose traces are to be queried. This parameter is valid only when **trace_type** is set to **system**. The value can contain uppercase letters.                                                                                                                                                                                                                                        |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | resource_type   | No              | String          | Type of a resource whose traces are to be queried. This parameter is valid only when **trace_type** is set to **system**.                                                                                                                                                                                                                                                                                 |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | trace_id        | No              | String          | Trace ID. If this parameter is specified, other query criteria will not take effect. This parameter is valid only when **trace_type** is set to **system**.                                                                                                                                                                                                                                               |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | trace_name      | No              | String          | Trace name. This parameter is valid only when **trace_type** is set to **system**. The value can contain uppercase letters.                                                                                                                                                                                                                                                                               |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | trace_rating    | No              | String          | Trace status. The value can be **normal**, **warning**, or **incident**. This parameter is valid only when **trace_type** is set to **system**.                                                                                                                                                                                                                                                           |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                                                                                           |
   |                 |                 |                 | Enumerated values:                                                                                                                                                                                                                                                                                                                                                                                        |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                                                                                           |
   |                 |                 |                 | -  **normal**                                                                                                                                                                                                                                                                                                                                                                                             |
   |                 |                 |                 | -  **warning**                                                                                                                                                                                                                                                                                                                                                                                            |
   |                 |                 |                 | -  **incident**                                                                                                                                                                                                                                                                                                                                                                                           |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Request Parameters
------------------

None

Response Parameters
-------------------

**Status code: 200**

.. table:: **Table 3** Response body parameters

   +-----------+------------------------------------------------------------------------------------------------+-------------------------------------------+
   | Parameter | Type                                                                                           | Description                               |
   +===========+================================================================================================+===========================================+
   | traces    | Array of :ref:`Traces <cts_api_0311_01__en-us_topic_0000001168237830_response_traces>` objects | List of returned traces.                  |
   +-----------+------------------------------------------------------------------------------------------------+-------------------------------------------+
   | meta_data | :ref:`MetaData <cts_api_0311_01__en-us_topic_0000001168237830_response_metadata>` object       | Number of returned traces and the marker. |
   +-----------+------------------------------------------------------------------------------------------------+-------------------------------------------+

.. _cts_api_0311_01__en-us_topic_0000001168237830_response_traces:

.. table:: **Table 4** Traces

   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter             | Type                  | Description                                                                                                                                                                            |
   +=======================+=======================+========================================================================================================================================================================================+
   | resource_id           | String                | ID of a cloud resource on which the recorded operation was performed.                                                                                                                  |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | trace_name            | String                | Trace name. The value can contain 1 to 64 characters, including letters, digits, hyphens (-), underscores (_), and periods (.). It must start with a letter.                           |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | trace_rating          | String                | Trace status. The value can be **normal**, **warning**, or **incident**.                                                                                                               |
   |                       |                       |                                                                                                                                                                                        |
   |                       |                       | Enumerated values:                                                                                                                                                                     |
   |                       |                       |                                                                                                                                                                                        |
   |                       |                       | -  **normal**                                                                                                                                                                          |
   |                       |                       | -  **warning**                                                                                                                                                                         |
   |                       |                       | -  **incident**                                                                                                                                                                        |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | trace_type            | String                | Trace source. For management traces, the value can be **ApiCall**, **ConsoleAction**, or **SystemAction**. For data traces, the value can be **ObsSDK** and **ObsAPI**.                |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | request               | String                | Request of an operation on resources.                                                                                                                                                  |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | response              | String                | Response to a user request, that is, the returned information for an operation on resources.                                                                                           |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | code                  | String                | HTTP status code returned by the associated API.                                                                                                                                       |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | api_version           | String                | Version of the API.                                                                                                                                                                    |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | message               | String                | Remarks added by other cloud services to a trace.                                                                                                                                      |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | record_time           | Long                  | Timestamp when an operation was recorded by CTS.                                                                                                                                       |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | trace_id              | String                | Trace ID. The value is the UUID generated by the system.                                                                                                                               |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | time                  | Long                  | Timestamp when a trace was generated.                                                                                                                                                  |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | user                  | Object                | Information of the user who performed the operation that triggered the trace. For details, see :ref:`UserInfo <cts_api_0311_01__en-us_topic_0000001168237830_response_userinfo>`.      |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | service_type          | String                | Type of a cloud service whose traces are to be queried. The value must be the acronym of a cloud service that has been connected with CTS. It is a word composed of uppercase letters. |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | resource_type         | String                | Type of the resource on which the operation was performed.                                                                                                                             |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | source_ip             | String                | IP address of the tenant who performed the operation that triggered the trace.                                                                                                         |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | resource_name         | String                | Name of a resource on which the recorded operation was performed.                                                                                                                      |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | request_id            | String                | Request ID.                                                                                                                                                                            |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | location_info         | String                | Additional information required for fault locating after a request error.                                                                                                              |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | endpoint              | String                | Endpoint in the details page URL of the cloud resource on which the recorded operation was performed.                                                                                  |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | resource_url          | String                | Details page URL (excluding the endpoint) of the cloud resource on which the recorded operation was performed.                                                                         |
   +-----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _cts_api_0311_01__en-us_topic_0000001168237830_response_userinfo:

.. table:: **Table 5** UserInfo

   +-----------+--------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter | Type   | Description                                                                                                                                                                        |
   +===========+========+====================================================================================================================================================================================+
   | id        | String | User ID. For details, see :ref:`Obtain the Account ID and Project ID <cts_api_0126>`.                                                                                              |
   +-----------+--------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | name      | String | Username                                                                                                                                                                           |
   +-----------+--------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | domain    | Object | Domain information of the user who performed the operation generating the trace. For details, see :ref:`Domain <cts_api_0311_01__en-us_topic_0000001168237830_response_baseuser>`. |
   +-----------+--------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _cts_api_0311_01__en-us_topic_0000001168237830_response_baseuser:

.. table:: **Table 6** Domain

   ========= ====== =============
   Parameter Type   Description
   ========= ====== =============
   id        String Account ID
   name      String Account name.
   ========= ====== =============

.. _cts_api_0311_01__en-us_topic_0000001168237830_response_metadata:

.. table:: **Table 7** MetaData

   +-----------+---------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter | Type    | Description                                                                                                                                                                            |
   +===========+=========+========================================================================================================================================================================================+
   | count     | Integer | Number of returned traces.                                                                                                                                                             |
   +-----------+---------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | marker    | String  | ID of the last trace in the returned trace list. The value of this parameter can be used as the **next** value. If the value of **marker** is **null**, all traces have been returned. |
   +-----------+---------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

**Status code: 400**

.. table:: **Table 8** Response body parameters

   ========== ====== ====================================
   Parameter  Type   Description
   ========== ====== ====================================
   error_code String Error code. Format: **CTS.**\ *XXX*.
   error_msg  String Error description.
   ========== ====== ====================================

Example Request
---------------

-  Querying management traces

   .. code-block:: text

      GET https://{endpoint}/v3/{project_id}/traces?limit=11&to=1479095278000&from=1478490478000&trace_name=createTracker&resource_type=tracker&service_type=CTS&trace_type=system

-  Querying data traces

   .. code-block:: text

      GET https://{endpoint}/v3/{project_id}/traces?limit=11&to=1479095278000&from=1478490478000&trace_type=data

Example Response
----------------

**Status code: 200**

The request is successful.

.. code-block::

   {
    "traces": [
     {
      "request": "{\"status\":\"enabled\",\"tracker_name\":\"system\",\"tracker_type\":\"system\",\"is_support_trace_files_encryption\":false,\"is_support_validate\":false,\"obs_info\":{\"bucket_name\":\"\",\"file_prefix_name\":\"\",\"is_obs_created\":false}}",
      "trace_id": "a51490ed-31a4-11ee-84a5-37fecdc7f23c",
      "code": "201",
      "trace_name": "createTracker",
      "is_consistent": true,
      "resource_type": "tracker",
      "trace_rating": "normal",
      "api_version": "v1.0",
      "source_ip": "127.0.0.1",
      "trace_type": "ConsoleAction",
      "service_type": "CTS",
      "event_type": "system",
      "project_id": "24ed***************463e610764",
      "response": "{\"create_time\":1691029370543,\"domain_id\":\"xxxxxx\",\"enterprise_project_id\":\"0\",\"id\":\"0a2b10a9-********-a6fd-79c82b22b178\",\"is_organization_tracker\":false,\"is_support_trace_files_encryption\":false,\"is_support_validate\":false,\"obs_info\":{\"bucket_lifecycle\":0,\"bucket_name\":\"\",\"file_prefix_name\":\"\",\"is_authorized_bucket\":false,\"is_obs_created\":false,\"is_sort_by_service\":true},\"project_id\":\"24ed***************463e610764\",\"status\":\"enabled\",\"tag\":{},\"tracker_name\":\"system\",\"tracker_type\":\"system\"}",
      "tracker_name": "system",
      "time": 1691029370884,
      "resource_name": "system",
      "user": {
       "domain": {
        "name": "xxxxxxxx",
        "id": "xxxxxxxxxxx"
       },
       "name": "xxxxxxxxx",
       "id": "xxxxxxxxxxxxxx"
      },
      "record_time": 1691029370884
     },
     {
      "trace_id": "9cb63bda-31a4-11ee-84a5-37fecdc7f23c",
      "code": "204",
      "trace_name": "deleteTracker",
      "is_consistent": true,
      "resource_type": "tracker",
      "trace_rating": "normal",
      "api_version": "v1.0",
      "source_ip": "127.0.0.1",
      "trace_type": "ApiCall",
      "service_type": "CTS",
      "event_type": "system",
      "project_id": "24ed***************463e610764",
      "tracker_name": "system",
      "time": 1691029356829,
      "resource_name": "system",
      "user": {
       "domain": {
        "name": "xxxx",
        "id": "xxxxxxxxxxx"
       },
       "name": "xxx",
       "id": "xxxxx"
      },
      "record_time": 1691029356829
     }
    ],
    "meta_data": {
     "marker": "1691029356829488910",
     "count": 2
    }
   }

Status Codes
------------

+-------------+-------------------------------------------------------------------------------------------------------+
| Status Code | Description                                                                                           |
+=============+=======================================================================================================+
| 200         | The request is successful.                                                                            |
+-------------+-------------------------------------------------------------------------------------------------------+
| 400         | The query parameters are abnormal.                                                                    |
+-------------+-------------------------------------------------------------------------------------------------------+
| 401         | The request is rejected due to authentication failure.                                                |
+-------------+-------------------------------------------------------------------------------------------------------+
| 403         | The server understood the request but refused to authorize it.                                        |
+-------------+-------------------------------------------------------------------------------------------------------+
| 404         | The requested trace does not exist.                                                                   |
+-------------+-------------------------------------------------------------------------------------------------------+
| 500         | Failed to complete the request because of an internal service error.                                  |
+-------------+-------------------------------------------------------------------------------------------------------+
| 503         | The requested service is unavailable. The client should not repeat the request without modifications. |
+-------------+-------------------------------------------------------------------------------------------------------+

Error Codes
-----------

See :ref:`Error Codes <cts_api_0125>`.
